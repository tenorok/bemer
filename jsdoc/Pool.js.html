<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Pool.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Pool.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>definer('Pool', /** @exports Pool */ function(array, object) {

    /**
     * Модуль хранения списка шаблонов.
     *
     * @constructor
     */
    function Pool() {

        /**
         * Список шаблонов.
         *
         * @type {Template[]}
         */
        this.pool = [];
    }

    Pool.prototype = {

        /**
         * Добавить шаблон или несколько шаблонов.
         *
         * @param {...Template} template Шаблон к добавлению
         * @returns {Pool}
         */
        add: function(template) { /* jshint unused: false */
            var args = arguments,
                templates = Object.keys(args).reduce(function(templates, key) {
                    return templates.concat(args[key].split());
                }, []);

            templates.forEach(function(template) {
                var indexes = this.is(template);

                // Так как шаблоны разбиты по единичным селекторам,
                // результатом поиска может быть только один индекс или null.
                this.pool.push(indexes ? this.pool[indexes[0]].extend(template) : template);

            }, this);

            return this;
        },

        /**
         * Найти индексы подходящих для наследования шаблонов
         * для каждого селектора указанного шаблона.
         *
         * Результатом всегда возвращается массив индексов
         * или `null`, если подходящие шаблоны не были найдены.
         *
         * @param {Template} template Шаблон для поиска
         * @returns {number[]|null}
         */
        is: function(template) {
            var indexes = [];

            template.split().forEach(function(currentTemplate) {
                for(var index = this.pool.length - 1; index >= 0; index--) {
                    if(this.pool[index].is(currentTemplate)) {
                        indexes.push(index);
                        break;
                    }
                }
            }, this);

            return indexes.length ? indexes : null;
        },

        /**
         * Найти и применить шаблон для BEMJSON.
         *
         * @param {object} bemjson BEMJSON
         * @param {object} [data] Данные по сущности в дереве
         * @returns {Node|null} Экземпляр БЭМ-узла или null при отсутствии подходящего шаблона
         */
        find: function(bemjson, data) {
            var node = null,
                nextNode = null,
                currentBemjson = bemjson,

                /**
                 * Обработанные шаблоны.
                 *
                 * @type {Template[]}
                 */
                processedTemplates = [],

                /**
                 * Обработанные модификаторы.
                 *
                 * @type {object[]}
                 * @property {string} object.modName Имя модификатора блока
                 * @property {string} object.elemModName Имя модификатора элемента
                 */
                processedMods = [],

                /**
                 * Установленные из шаблонов моды.
                 *
                 * @type {object}
                 * @property {object} * Имя моды
                 * @property {number} *.weight Вес шаблона
                 * @property {number} *.index Порядковый номер шаблона в общем списке
                 */
                modesFromTemplates = {};

            for(var index = this.pool.length - 1; index >= 0; index--) {
                if(~processedTemplates.indexOf(this.pool[index])) continue;

                if(node) {
                    currentBemjson = node.bemjson();
                }

                nextNode = this.pool[index].match(
                    currentBemjson,
                    data,
                    processedMods,
                    bemjson,
                    modesFromTemplates,
                    index
                );

                if(nextNode) {
                    node = nextNode;
                    processedTemplates.push(this.pool[index]);

                    // Если изменился набор модификаторов, шаблоны нужно прогонять заново.
                    if(!object.isEqual(currentBemjson.mods || {}, node.bemjson().mods) ||
                        !object.isEqual(currentBemjson.elemMods || {}, node.bemjson().elemMods)) {
                        index = this.pool.length;
                    }
                }
            }

            return node;
        },

        /**
         * Удалить все шаблоны.
         *
         * @returns {Pool}
         */
        clean: function() {
            this.pool = [];
            return this;
        }

    };

    return Pool;

});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-bemer.html">bemer</a></li><li><a href="module-Helpers.html">Helpers</a></li><li><a href="module-Match.html">Match</a></li><li><a href="module-modules.html">modules</a></li><li><a href="module-Node.html">Node</a></li><li><a href="module-Pool.html">Pool</a></li><li><a href="module-Selector.html">Selector</a></li><li><a href="module-Tag.html">Tag</a></li><li><a href="module-Template.html">Template</a></li><li><a href="module-Tree.html">Tree</a></li></ul><h3>Classes</h3><ul><li><a href="module-bemer-bemer.html">bemer</a></li><li><a href="module-Helpers-Helpers.html">Helpers</a></li><li><a href="module-Match-Match.html">Match</a></li><li><a href="module-modules-modules.html">modules</a></li><li><a href="module-Node-Node.html">Node</a></li><li><a href="module-Pool-Pool.html">Pool</a></li><li><a href="module-Selector-Selector.html">Selector</a></li><li><a href="module-Tag-Tag.html">Tag</a></li><li><a href="module-Template-Template.html">Template</a></li><li><a href="module-Tree-Tree.html">Tree</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha8</a> on Sun Nov 23 2014 15:48:22 GMT+0400 (MSK)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
